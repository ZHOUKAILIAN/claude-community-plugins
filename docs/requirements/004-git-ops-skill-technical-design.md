# 技术方案 004: Git Ops Helper - 技术设计

## 文档信息

- **编号**: TECH-004
- **标题**: Git Ops Helper - Git 操作 Skill 技术设计
- **版本**: 1.0.0
- **创建日期**: 2026-01-16
- **状态**: 待实现
- **依赖**: REQ-004 (Git Ops Helper - Git 操作 Skill)

## 1. 技术架构概述

### 1.1 整体设计思路

**核心理念**：提供安全、可复用的 Git 专家级工作流，覆盖提交总结、提交信息生成、冲突解决与 rebase 指导，并对高风险操作进行二次确认。

**技术路线**：

```
上下文采集 → 变更总结 → 提交信息生成 → 用户确认 → 执行 Git 操作
```

**设计原则**：

- **安全优先**：高风险操作必须确认，默认推荐更安全替代方案
- **可解释**：输出清晰的原因、影响范围与建议命令
- **可配置**：提交信息支持默认风格与用户自定义模板
- **本地优先**：仅依赖本地 Git CLI，不访问网络

### 1.2 插件架构设计

```
git-ops-helper/
├── .claude-plugin/
│   └── plugin.json
├── skills/
│   └── git-ops-helper/
│       ├── SKILL.md
│       ├── references/
│       │   ├── commit-messages.md
│       │   └── conflict-resolution.md
│       └── assets/ (可选，暂不需要)
├── commands/
│   └── summarize-commit.md
├── README.md
└── README-zh.md
```

## 2. 核心能力详细设计

### 2.1 触发场景

- 请求总结改动并生成提交信息
- 请求冲突解决、rebase/cherry-pick/merge 指导
- 请求回滚、重置等高风险操作评估与建议

### 2.2 上下文采集

**必备命令**：

- `git status -sb`
- `git diff`
- `git diff --staged`
- `git log -n 5 --oneline`

**摘要规则**：区分已暂存与未暂存改动，必要时分别汇总。

**辅助工具**：不依赖脚本，直接执行 Git 命令采集上下文。

### 2.3 变更总结策略

- 先进行代码检查，再输出摘要
- 若检查发现问题，先提示用户并等待确认后再继续
- 输出变更摘要（中英文可选，默认跟随用户语言）：影响范围、主要改动、行为变化、测试情况
- 仅描述已发生的变化，不猜测未确认内容
- 若无测试变更，明确标注“未涉及测试”

### 2.4 提交信息生成策略

- 默认采用 Conventional Commits 风格（见 `references/commit-messages.md`）
- 用户提供模板时优先遵循自定义格式
- 生成提交信息后，展示建议命令并等待确认
- 若当前分支为 main/master，先询问是否切出新分支再继续提交流程

## 3. 命令设计

### 3.1 summarize-commit

**功能目标**：汇总当前变更并生成提交信息建议。

**执行流程**：

1. 采集 Git 上下文
2. 对改动进行代码检查
3. 若发现问题，先提示用户并等待确认是否继续
4. 输出变更摘要（默认跟随用户语言）
5. 生成提交信息草案
6. 提示可执行的 `git commit` 命令并等待确认

**输出格式要求**：

- 简短摘要 + 推荐提交信息
- 标注是否为默认风格或自定义风格

## 4. Git 专家能力设计

### 4.1 冲突解决

- 读取 `references/conflict-resolution.md`
- 标注冲突文件列表
- 给出逐步命令与处理建议（resolve → add → continue）

### 4.2 Rebase 指导

- 先确认目标（线性历史、squash、reorder）
- 明确是否允许强制推送
- 提供可回退路径（`rebase --abort`）

### 4.3 回滚与重置

- 优先建议 `git revert`
- 明确 reset 三种模式差异与风险
- `reset --hard` 和强制推送必须二次确认

## 5. 安全与确认机制

- 执行破坏性命令前必须确认
- 所有 Git 操作必须二次确认后执行
- 始终先展示完整命令
- 提供风险提示与替代方案

## 6. 验收与测试

- summarize-commit 能输出正确摘要与提交信息
- 冲突与 rebase 指导可落地执行
- 高风险操作具备明确二次确认
- TODO: 评估后续接入 /review 或更完善的代码审查流程
