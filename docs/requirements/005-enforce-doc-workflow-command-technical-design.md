# 技术方案 005: 强制文档驱动开发命令 - 技术设计

## 文档信息

- **编号**: TECH-005
- **标题**: 强制文档驱动开发命令技术方案
- **版本**: 1.0.0
- **创建日期**: 2026-01-16
- **状态**: 待实现
- **依赖**: BUG-005 (缺少强制执行文档驱动开发流程的命令)

## 1. 技术架构概述

### 1.1 整体设计思路

**核心理念**：为文档驱动开发流程提供可执行的拦截与引导机制，确保在代码变更前完成需求与技术方案文档。

**技术路线**：
```
启用强制模式 → 意图识别 → 文档检查 → 文档引导 → 允许代码实现
```

### 1.2 架构设计

```
ai-doc-driven-dev/
├── commands/
│   └── enforce-doc-workflow.md
├── skills/
│   ├── doc-detector/
│   ├── doc-generator/
│   └── claude-md-enforcer/
└── knowledge/templates/
```

## 2. 核心技能详细设计

### 2.1 enforce-doc-workflow (流程强制执行)

**功能职责**：
- 启用强制模式并记录状态
- 拦截代码变更请求
- 触发文档完整性检查与创建引导

**实现思路**：
```
if (is_enforce_mode) {
  if (detect_code_change_intent(request)) {
    require_docs();
  }
}
```

**规则/约束**：
- 仅在强制模式下拦截
- 文档完整性检查通过后才允许写代码
- 代码改动必须与技术方案对齐，不一致时必须先更新方案

### 2.2 doc-detector (文档完整性检查)

**功能职责**：
- 检查需求文档与技术方案文档是否存在
- 验证文档结构与关键段落

**规则/约束**：
- 需求文档路径：`docs/requirements/`
- 技术方案路径：`docs/requirements/`

### 2.3 doc-generator (文档引导生成)

**功能职责**：
- 使用模板创建需求与技术方案
- 引导用户补充内容

**规则/约束**：
- 模板来源：
  - `docs/standards/requirements-template.md`
  - `docs/standards/technical-design-template.md`

## 强制性开发工作流程

1. 用户执行 `/enforce-doc-workflow`
2. 进入强制模式
3. 代码变更意图触发检查
4. 引导补齐需求与技术方案
5. 检查方案与代码改动一致性
6. 文档确认后允许代码实现

## 约束条件

- 不得绕过流程直接修改代码
- 文档缺失时必须先引导创建

## 3. 工作流程设计

### 3.1 插件执行流程

```
用户请求 → 意图识别 → 文档检查 → 文档创建/确认 → 代码执行
```

### 3.2 技能调用策略

- `enforce-doc-workflow` 作为入口命令
- `doc-detector` 检测文档
- `doc-generator` 生成模板

## 4. 数据流设计

### 4.1 技能间数据传递

- 传递用户意图、目标功能、文档路径

### 4.2 文件系统交互

- 读取 `docs/requirements/`
- 写入模板文档

## 5. 性能优化策略

### 5.1 缓存机制

- 缓存文档检查结果，避免重复扫描

### 5.2 并行处理

- 文档检查与意图识别并行执行

## 6. 扩展性设计

### 6.1 模板系统

- 支持按项目类型扩展模板库

### 6.2 插件接口

- 为未来增加“审查/评审”插件预留接入点

## 7. 质量保证

### 7.1 测试策略

- 覆盖强制模式开启/关闭
- 覆盖文档缺失/存在场景

### 7.2 质量指标

- 触发拦截准确率
- 文档创建成功率
